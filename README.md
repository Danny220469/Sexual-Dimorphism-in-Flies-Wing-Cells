# Sexual Dimorphism in Fly Wing Cells

## üß¨ Geometric Morphometrics Pipeline
This repository contains a complete bioinformatics pipeline for analyzing wing shape variations in Diptera species (e.g., *Calliphora vicina*, *Chrysomya albiceps*) using **Elliptic Fourier Descriptors (EFD)**.

The project investigates **Sexual Dimorphism** and **Geographic Variation** by processing wing images, generating shape coefficients, performing statistical tests, and creating interactive 3D visualizations.

---

## üìÇ Repository Structure

### 1. Image Pre-processing & Segmentation (Python)
* **IOPaint (External Tool)**:  
    The first step in the pipeline. Utilized to remove artifacts (dust, mounting pins, reflection gloss) from raw wing images *before* segmentation to ensure the highest accuracy.
* **`single_segment.py`**:  
    An interactive tool using the **Segment Anything Model (SAM)**. Allows the user to manually segment individual wing images by clicking positive (wing) and negative (background) points.
* **`batch_segment.py`**:  
    Automates segmentation for large datasets. The user defines keypoints on a single "template" image, and the script propagates these prompts to automatically segment an entire folder of cleaned images.

### 2. Data Processing (R)
* **`efd_generation.r`**:  
    Reads the binary masks generated by SAM, normalizes them (size, rotation, phase) using the `Momocs` package, and generates Elliptic Fourier Descriptors.
* **`PCA_1.r`**:  
    Performs Principal Component Analysis (PCA) on the normalized EFD coefficients. It automatically selects the number of Principal Components (PCs) required to explain **90% of the cumulative variance**.

### 3. Statistical Analysis (R)
* **`manova.r`**:  
    Runs Multivariate Analysis of Variance (MANOVA) to calculate the percentage of shape variation attributed to Species, Sex, Locality, and their interactions.
* **`hottelling.r`**:  
    Performs **Hotelling‚Äôs $T^2$ test** to determine if the shape difference between Males and Females is statistically significant within specific populations.

### 4. Visualization (Python)
* **`contour_check.py`**:  
    Reconstructs average wing shapes from EFD coefficients to visualize Mean Male vs. Mean Female outlines.
* **`plot_PCA_1.py`**:  
    Generates high-quality, interactive **3D Scatter Plots** using Plotly. Features custom styling (Lato font), grouping by population, and detailed hover metadata.

---

## üõ†Ô∏è Dependencies

To run this pipeline, you will need the following installed.

### Python Packages (Segmentation & Visualization)
You must download the SAM checkpoint (`sam_vit_b_01ec64.pth`) for segmentation.
```bash
# Image Cleaning Tool
pip install iopaint

# Segmentation (Meta AI Segment Anything)
pip install opencv-python torch torchvision segment-anything

# Visualization
pip install pandas numpy matplotlib plotly
